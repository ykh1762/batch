<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="yogurt">

	<select id="getCycleList" resultType="cycleVo">
		SELECT *
		  FROM CYCLE
	</select>
	
	<insert id="insertDaily" parameterType="dailyVo">
		INSERT INTO DAILY
		VALUES (#{cid}, #{pid}, #{dt}, #{cnt})
	</insert>
	
	<!-- 입력하려고하는 데이터가 존재하면 update, 없으면 insert. 먼저 입력하려고 하는 데이터의 존재
		 여부를 확인한다.(merge) -->
	<insert id="mergeDaily" parameterType="dailyVo">
		MERGE INTO DAILY
		USING DUAL ON(
		    DAILY.CID = #{cid} AND
		    DAILY.PID = #{pid} AND
		    DAILY.DT = #{dt})
		-- 해당 데이터가 존재하는 경우.
		WHEN MATCHED THEN UPDATE SET
		    CNT = #{cnt}
		WHEN NOT MATCHED THEN INSERT
		    (cid, pid, dt, cnt) VALUES (#{cid}, #{pid}, #{dt}, #{cnt})
	</insert>
	
  	
</mapper>















