<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="yogurt">

	<!-- 일실적 일괄 삭제. -->
	<delete id="deleteDailyAllYm" parameterType="String">
		DELETE DAILY WHERE DT LIKE #{ym} || '%'
	</delete>
	
	<!-- 일실적 생성 -->
	<!-- xml에서는 <, >, & 사용 못함. -> '&lt;'로 사용(<) -->
	<insert id="dailyBatchYm" parameterType="String">
		INSERT INTO DAILY
		SELECT CYCLE.CID, CYCLE.PID, CAL.DT, CYCLE.CNT
		FROM CYCLE,
		    (SELECT TO_CHAR(TO_DATE(#{ym} || '01', 'yyyyMMdd') + (LEVEL-1), 'd') DAY,
		            TO_CHAR(TO_DATE(#{ym} || '01', 'yyyyMMdd') + (LEVEL-1), 'yyyyMMdd') DT
		       FROM DUAL
		     CONNECT BY LEVEL &lt;= LAST_DAY(TO_DATE(#{ym}, 'yyyyMM')) 
		             - TO_DATE(#{ym} || '01', 'yyyyMMdd') + 1) CAL
		WHERE CYCLE.DAY = CAL.DAY
	</insert>
	
		
  	
</mapper>















